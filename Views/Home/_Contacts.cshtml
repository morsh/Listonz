<div data-bind="with: contacts">
    <div data-bind="showHide: loaded" class="vm-view vm-contacts">
        <div data-bind="ifnot: showEditor()">
            <table>
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Company</th>
                        <th>Category</th>
                    </tr>
                </thead>
                <tbody class="tr-highlight" data-bind="foreach: collection">
                    <tr>
                        <td data-bind="text: Id"></td>
                        <td data-bind="text: FirstName"></td>
                        <td data-bind="text: LastName"></td>
                        <td><span data-bind="if: Company != null"><span data-bind="text: Company.FirstName"></span></span></td>
                        <td><span data-bind="if: Category != null"><span data-bind="text: Category.Name"></span></span></td>
                        <td>
                            <button class="btn btn-mini btn-edit" data-bind="click: $parent.edit" title="Edit Contact"></button>
                            <button class="btn btn-mini btn-delete" data-bind="click: $parent.remove" title="Delete Contact"></button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <input type="button" id="btnGetcontacts" value="Get contacts" data-bind="click: refresh" />
            <input type="button" value="Add" data-bind="click: edit" />
        </div>
        <div data-bind="if: showEditor" class="edit">
            <div data-bind=" { with: select(), jqValidation: validationContext } ">
                <section class="head">
                    <div class="prf-pic" onclick="vm.contacts.changePicture();">
                        <span data-bind="ifnot: ProfilePicture"><img src="~/Images/profile.jpg" width="70px" /></span>
                        <span data-bind="if: ProfilePicture"><img data-bind=" attr: { src: ProfilePicture }" src="" width="70px" /></span>
                        <div class="pic-edit">Change</div>

                        <!-- Url enter dialog -->
                        <div id="dialog-picture" class="dialog" title="Enter a Profile Picture">
                          <form>
                          <fieldset>
                            <label for="PictureUrl">Picture Url</label>
                            <input type="text" name="PictureUrl" id="PictureUrl" class="text ui-widget-content ui-corner-all" style="width: 800px;" />
                          </fieldset>
                          </form>
                        </div>
                    </div>
                    <div>
                        <h2>
                            <span data-bind="if: FirstName() == '' && LastName() == '' && $parent.isNew()">Add New Contact</span>
                            <span data-bind="text: FirstName"></span>
                            <span data-bind="text: LastName"></span>
                        </h2>
                    </div>
                    <div class="email">
                        <a data-bind="attr: { href: 'mailto:' + Email() }">
                            <div class="float-left"><img src="~/Images/email.png" height="20" /></div>
                            <div data-bind="if: Email() == ''" class="float-left">No Email Found</div>
                            <div data-bind="text: Email" class="float-left"></div>
                        </a>
                    </div>
                    <div class="rating">
                        <div data-bind="rateit: { value: Rating, max: 5, step: 0.1 }"></div>
                    </div>
                </section>
                <ul class="float-left">
                    <li>
                        <span><input type="text" data-bind="value: FirstName" placeholder="First Name" data-required="true" /></span>
                    </li>
                    <li>
                        <span><input type="text" data-bind="value: LastName" placeholder="Last Name" /></span>
                    </li>
                    <li class="company">
                        <span class="rel">
                            <hidden data-bind="value: CompanyId" value="" ></hidden>
                            <input type="text" placeholder="Company" data-bind="
                                value: $parent.EditCompanyName,
                                enable: Category != undefined && Category.Name != 'Company',
                                valueUpdate: 'afterkeydown',
                                autocomplete_select: 'UpdateCompany',
                                autocomplete_render: 'renderCompany',
                                autoComplete: $parent.api + $parent.options.getAll + '?$filter=substringof(\'REP_URL\',FirstName) and Category eq \'Company\''" />
                            <div class="add-choice" data-bind="
                                showHide: (CompanyId() == undefined || CompanyId() == '') && $parent.EditCompanyName() != '' && $parent.EditCompanyName() != undefined,
                                click: $parent.AddNewCompany ">
                                Add
                            </div>
                            <div class="add-form" data-bind="showHide: $parent.NewCompany">
                                 <ul class="float-left" data-bind="if: $parent.NewCompany">
                                    <li>
                                        <span><input type="text" id="comp-name" placeholder="Company Name" data-required="true" /></span>
                                    </li>
                                     <li>
                                        <span><input type="text" id="comp-emal" placeholder="Email" /></span>
                                    </li>
                                     <li>
                                        <span><input type="text" id="comp-pnum" placeholder="Phone Number" /></span>
                                    </li>
                                    <li>
                                        <input type="button" value="Save" data-bind="click: $parent.saveCompany" />
                                        <input type="button" value="Cancel" data-bind="click: $parent.cancelCompany" />
                                     </li>
                                </ul>
                            </div>
                        </span>
                    </li>
                    <li>
                        <span><input type="text" data-bind="value: Country,
    autoComplete: '/api/contacts/GetCountries',
    autocomplete_select: 'UpdateCountry',
    autocomplete_render: 'renderCountry',
    autocomplete_cache: 'filterCountry'" placeholder="Country" /></span>
                    </li>
                    <li>
                        <span><input type="text" data-bind="value: State,
    autoComplete: '/api/contacts/GetStates?country=' + $parent.selectedCountry(),
    autocomplete_select: 'UpdateState',
    autocomplete_render: 'renderState',
    autocomplete_cache: 'filterState'" placeholder="State" /></span>
                    </li>
                    <li>
                        <span><input type="text" data-bind="value: City,
    autoComplete: '/api/contacts/GetCities?country=' + $parent.selectedCountry(),
    autocomplete_select: 'UpdateCity',
    autocomplete_cache: true" placeholder="City" /></span>
                    </li>
                    <li>
                        <span><input type="text" data-bind="value: Street" placeholder="Street" /></span>
                    </li>
                    <li>
                        <span><textarea data-bind="value: Notes" placeholder="Notes" data-required="true"></textarea></span>
                    </li>
                </ul>
                <ul class="float-right">
                    <li class="category">
                        <span class="rel">
                            <hidden data-bind="value: CategoryId" value="" ></hidden>
                            <input type="text" placeholder="Category" onclick="if ($(this).val() == '') $(this).autocomplete('search', '');" data-bind="
    value: $parent.EditCategoryName,
    valueUpdate: 'afterkeydown',
    autocomplete_select: 'UpdateCategory',
    autocomplete_render: 'renderCategory',
    autoComplete: $parent.cat_api + $parent.cat_options.getAll + '?$filter=substringof(\'REP_URL\',Name)'" />
                            <div class="add-choice" data-bind="
    showHide: (CategoryId() == undefined || CategoryId() == '') && $parent.EditCategoryName() != '' && $parent.EditCategoryName() != undefined,
    click: $parent.saveCategory">
                                Add
                            </div>
                            <div class="add-form" data-bind="showHide: $parent.NewCategory">
                                 <ul class="float-left" data-bind="if: $parent.NewCategory">
                                    <li>
                                        <span><input type="text" id="cat-name" placeholder="Category Name" data-required="true" /></span>
                                    </li>
                                    <li>
                                        <input type="button" value="Save" data-bind="click: $parent.saveCategory" />
                                        <input type="button" value="Cancel" data-bind="click: $parent.cancelCategory" />
                                     </li>
                                </ul>
                            </div>
                        </span>
                    </li>
                    <li>
                        <span>
                            <input type="text"
                                data-bind="value: Email"
                                placeholder="Email"
                                data-required="true"
                                data-email="true" /></span>
                    </li>
                    <li>
                        <span><input type="tel" data-bind="value: PhoneNumber" placeholder="Phone Number" data-phone="true" data-validate="true" /></span>
                    </li>
                    <li>
                        <span><input type="text" data-bind="value: MobileNumber" placeholder="Mobile Number" data-phone="true" data-validate="true" /></span>
                    </li>
                    <li>
                        <span><input type="text" data-bind="value: FaxNumber" placeholder="Fax Number" data-phone="true" data-validate="true" /></span>
                    </li>
                    <li>
                        <span><input type="text" data-bind="datepicker: Birthday" placeholder="Birthday" data-date="true" data-validate="true" /></span>
                    </li>
                    <li class="chk-height">
                        <input type="checkbox" data-bind="checked: Single" />
                        <label onclick="$(this).prev().click()">Single</label>
                    </li>
                    <li>
                        <span>
                            <input type="text" data-bind="value: SocialSecurity" placeholder="Social Security / ID" /></span>
                    </li>
                    <li>
                        <span>
                            <input type="text" data-bind="value: DrivingLisence" placeholder="Driving Lisence" /></span>
                    </li>
                    <li>
                        <label style="white-space:nowrap" data-bind="ifnot: $parent.isNew()">
                            <span>Last Update: </span>
                            <span data-bind="text: moment(LastUpdate()).format('LL')"></span>
                        </label>
                    </li>
                </ul>
                <div class="float-left clear-both">
                    <div data-bind="foreach: $parent.validationErrors">
                        <div data-bind="text: $data"></div>
                    </div>
                    <input type="button" value="Save" data-bind="click: $parent.save" />
                    <input type="button" value="Cancel" data-bind="click: $parent.cancelEdit" />
                </div>
            </div>
        </div>
    </div>
</div>
